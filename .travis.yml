language: android
sudo: required
jdk: oraclejdk8
before_cache:
 - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
 - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
 directories:
 - $HOME/.gradle/caches/
 - $HOME/.gradle/wrapper/
 
env:
  global:
  - ANDROID_API_LEVEL=28
  - EMULATOR_API_LEVEL=22
  - ANDROID_BUILD_TOOLS=28.0.3
  - ADB_INSTALL_TIMEOUT=5
  - secure: "cfqsHco3YQi4Bq7J+9t0piRnunW3dy9VOae4MC4tPRfLPSDcR5iKWePvOoVEsBOc4Xe944vgRmr5FaRcSIbtPbypPaASh+qTGs6a0P98Buf+b0uQwsVE3cYr4cNIQOLjMH7qKpheXG5ELhz0+TDfve7m4C8IT2Gexhh0ro/s64m/5iZzVCHpMKR0Rb0ZUyGLs3mhzzq2kPEyatbFs2ofRIlR3V6BPdvSZbKsl9cfy78/YLKxrH14NgXh0VEBHJ3d5EaJZMp97aZFaquwrKXwQLBdkHdz9JY2/F8Bwgia0MzVAVFqHCIDo7bpBuds6q8dlYk4B+uraNlLj5SGkjiXIUXuQLDG6YC5npUAvdXPK83eVhJfoylgc5fQWUHY68qr25AfvooWaK6ZvbFbCdfo2J+pgu/ydmFiw9ClGN8JktWvsyG4CTo+RnNWxSXt/OhdF0wYoaLzNrrqWbh1uS7/zjZpbsmgtgx+W5Cwn09PfMUXnuVohkSHrUgtM1Z1WdHkAQlJu2aBVOnhMndW8pNyb0bpwKme1e4XIfi68y2bx23I658f+seypZOCqBeMJ7Jt3B3NU2OhuXSms/LlIPPPFl6oTpsMcxMhjMrdLlNcQxilw9RjCEst52YgPQqpn2OrcQk732MNax7ZWE/dknLrHdo+N6ChO9u8rDvg2Mk3rE4="
  - secure: "dwH5DA/jGzhdOr1PLpTYvjHmz0+OLd7QhMxrXc4biPdz1T9SPL/uu5/uyRValSvErK1bojs32OwJ8YEZ6I9PzPA1JUSTEVhiBQWUgBdqKs8aGlvhu94e+VBEvHgWlFlJBfijlEC8grpqUes0QBCzXvfDUaMa53zSEP4Tp45N0/rvolecAGuE4jMBnEO7kvRACPHxFXhHvu003eBlqceH75KseK0xbntoeinWoABPveycwMs/MjDt5xtgw6Y8aK+HlTU+RHdguzSbN2d7oiqbLcfWqhXuEfqZqAOOKGSHPqX/cbmIr3wCzO7z+PPYpAOZt3dfp57VWOS1DfzqNrw1kZ11ma+wuP8gLOaSy56MLk5S8DT1jNPZaJ8mWAlvGjXyDw6RXNRmBo1Dtr+SYhQER8utSzlv+Mc0fh4cPHiSXMxjjHj/e1uW/iQkWB31MDV+P/szNj/KgxUf9MX8C3UWle1YUF+D/L2GFcpvvBtZ2zaeCvhxME7h/k2+6UZ9zqhNXUU1MVmR69KaUSqi1WkbL0TDO7Qv4iUq91OIVbjjy6bzDd7LbZHIuXACejkYDoFJ09KECnNV2KVzJr22RKkgKMRCvkFkwxnrIa1XM4pDdKu5gV5A+ybyZ6JRi6UrFLJjn7lG1bX/0px30exQhxYF5/77PZw9GvVsUYApivX3yqM="
android:
  components:
  - tools
  - platform-tools
  - build-tools-$ANDROID_BUILD_TOOLS
  - android-$ANDROID_API_LEVEL
  - android-$EMULATOR_API_LEVEL
  - extra-google-m2repository
  - extra-android-m2repository
  - addon-google_apis-google-19
  - sys-img-armeabi-v7a-addon-google_apis-google-$ANDROID_API_LEVEL
  - sys-img-armeabi-v7a-android-$EMULATOR_API_LEVEL
  
  licenses:
  - android-sdk-preview-license-.+
  - android-sdk-license-.+
  - google-gdk-license-.+
before_install:
- cd Android
- openssl aes-256-cbc -K $encrypted_5342765ca437_key -iv $encrypted_5342765ca437_iv -in release.jks.enc -out release.jks -d
- chmod +x gradlew
- "./gradlew dependencies || true"
before_script:
- echo no | android create avd --force -n test -t android-$EMULATOR_API_LEVEL --abi
  armeabi-v7a
- emulator -avd test -no-skin -no-audio -no-window &
- android-wait-for-emulator
- adb shell input keyevent 82 &
script:
- "./gradlew clean build -Pbuild=dev"
before_deploy:
- cp $TRAVIS_BUILD_DIR/release.jks $HOME
- cd app/build/outputs/apk/dev/
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $HOME/release.jks -storepass $storepass -keypass $keypass app-dev-unsigned.apk alanndz
# Verification
- jarsigner -verify app-dev-unsigned.apk
- "${ANDROID_HOME}/build-tools/28.0.3/zipalign -v 4 app-dev-unsigned.apk aLnDNS.apk"
deploy:
  provider: releases
  file: aLnDNS.apk
  skip_cleanup: true
 
  on:
    repo: alanndz/Intra
    tags: true
    jdk: oraclejdk8
  api_key:
    secure: "RnTk1sGYPJWM9xO3aTkgh3woMtuHyUTbdVls1AhBuObxgx8Z5qGQW6HzcwFsT3yulSVJPzltTdK1zS6HLinJxXEzefoSk1LWRIzg5o0vZvvHAV50c6DVppEU2sOyqoJHSNzZ28cgPVmS9izU9mYL7/iUOmXwpcDht/0VuiBrtWQf446bYoOZ1PTxSY6VZ+LTz1/G07cvjb4EU18LVSohGqA/8wqxwvXzgh9DFWVyCskIktuIPRGWaiVCTbrp9W1RO/PG7entsLBQr6lGiQb0oJsM8qlcvJsN4AYF4S/ZlKPZFvmy24k83VN4lRB3cllFfz5vWqGYGa+0PCkqXTppcyKyrZNRRJzSNKM6azOAxOIsOXCrMDFIWwbL5XSNOFzm73qQ3/r1JSAyP3vv8gnFA8CGMnSyaPKi5dZ+j9cVRsqd1FjbP5hEBOjW6NCx18c+2wHKcS6MRo+t1XwB7fqMT1e9uBQOlV2sPvE8HRTC30B3gErKTw1iWhGU9p63r/0laXzgcHpigMlY9f2oCgpcbHfgK1CgG1XjdL1nTvTDOha+ZvspjZJl+g3o996q5DfvMV+yans4zAMfURVJHErEGaWNWpFEEKxAkqLoGPDboadqVyswN2N4QszKXDAIvDpor6phNzgAf22ah4YaO3SM0LdQRtAhpfA4KF5E30dRMa8="
 
